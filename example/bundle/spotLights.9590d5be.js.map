{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,S,wGAUA,IAAIC,EAAUC,EAAUC,EAAwBC,EAAWC,EAAQC,EAAYC,EAAiBC,EAAWC,EAAYC,EAAQC,EAC3HC,EACAC,EACAC,EACAC,EAGJ,MAAMC,EAAiB,CACtB,yGACA,yGACA,yGACA,yGACA,yGACA,yGACA,yGACA,yGACA,0GAIKC,EAAS,CAEdC,cAAe,CACdC,MAAO,UACPC,UAAW,IACXC,UAAW,IAEZC,aAAc,CACbH,MAAO,UACPC,UAAW,GACXC,UAAW,IAGZE,SAAS,EACTC,4BAA4B,EAC5BC,qBAAsB,GACtBC,QAAS,EACTC,gBAAiB,EACjBC,gBAAiB,EAAIC,OAAOC,iBAC5BC,mBAAoB,GACpBC,MAAO,EACPC,YAAY,EACZC,uBAAuB,EACvBC,iBAAiB,GA0SlB,SAASC,IAER,MAAMC,EAAIR,OAAOS,WACXC,EAAIV,OAAOW,YACXC,EAAQxB,EAAOW,gBACfc,EAAMb,OAAOC,iBAEnBrB,EAAWkC,QAASN,EAAII,EAAQC,EAAKH,EAAIE,EAAQC,GACjDjC,EAAWmC,QAEX3C,EAAS0C,QAASN,EAAGE,GACrBtC,EAAS4C,cAAehB,OAAOC,iBAAmBW,GAElD,MAAMK,EAAST,EAAIE,EAEnB3B,EAAkBkC,OAASA,EAC3BlC,EAAkBmC,wB,CAInB,SAASC,IAERvC,EAAWmC,O,CAIZ,SAASK,IAERC,sBAAuBD,GAGvB,MAAME,EAAKxC,EAAW,GACtBwC,EAAGhC,MAAMiC,IAAKnC,EAAOC,cAAcC,OAAQkC,sBAC3CF,EAAG9B,UAAYJ,EAAOC,cAAcG,UACpC8B,EAAG/B,UAAYH,EAAOC,cAAcE,UAEpC,MAAMkC,EAAK3C,EAAW,GA0BtB,GAzBA2C,EAAGnC,MAAMiC,IAAKnC,EAAOK,aAAaH,OAAQkC,sBAC1CC,EAAGjC,UAAYJ,EAAOK,aAAaD,UACnCiC,EAAGlC,UAAYH,EAAOK,aAAaF,UAGnCX,EAAW8C,SAASC,UAAUC,WAAYjD,EAAUgD,UAAWhD,EAAUkD,UAEzEjD,EAAW8C,SAASxB,mBAAqBd,EAAOc,mBAChDtB,EAAW8C,SAAS9B,qBAAuBR,EAAOQ,qBAClDhB,EAAW8C,SAAS7B,QAAUT,EAAOS,QACrCjB,EAAW8C,SAASI,eAAeF,WAAY7C,GAE/CH,EAAW8C,SAASK,OAAOH,WAAYpD,EAAQS,GAG/CF,EAAkBiD,oBAClBtD,EAAgBuD,WAGT7C,EAAOM,SAAWd,EAAWsD,QAAU,IAE7C9D,EAAS+D,OAAQnD,EAAOD,GAIpBK,EAAOM,QAAU,CAGrB,IAAM,IAAI0C,EAAI,EAAGC,EAAIjD,EAAOU,gBAAiBsC,EAAIC,EAAGD,IAEnDxD,EAAWqD,SAKZ7D,EAASkE,WAAY,EAErBzD,EAAO6C,SAASa,IAAM3D,EAAW4D,OAAOC,QACxC5D,EAAO6C,SAASgB,YAAa,EAC7B7D,EAAOsD,OAAQ/D,GAEfE,EAAuBqE,SAASC,SAASC,IAExCA,EAAEC,QAAUD,aAAa3E,EAAA6E,gBAAwB3D,EAAOkB,gBAAkBlB,EAAOiB,sBAC5E,YAAawC,IAAIA,EAAEnD,QAAUN,EAAOiB,sBAAqB,IAI/DjC,EAAS+D,OAAQ7D,EAAwBS,GAEzCX,EAASkE,WAAY,EAErBpD,EAAU8D,UAAY,YAAaC,KAAKC,MAAOtE,EAAWsD,U,EA/XxClC,OAAOS,WAAaT,OAAOW,YAC5B,MAElBvB,EAAOW,iBAAmB,GAC1BX,EAAOe,MAAQ,GAMhBgD,iBAGC/E,EAAW,IAAIF,EAAAkF,cAAqB,CAAEC,WAAW,IACjDjF,EAASkF,YAAcpF,EAAAqF,sBACvBnF,EAASoF,UAAUC,KAAOvF,EAAAwF,iBAC1BtF,EAASuF,cAAe,EAAG,GAC3BvF,EAASoF,UAAU9D,SAAU,EAC7BtB,EAASwF,yBAA0B,EACnCC,SAASC,KAAKC,YAAa3F,EAAS4F,YAGpC,MAAM/C,EAASjB,OAAOS,WAAaT,OAAOW,YAC1C5B,EAAoB,IAAIkF,EAAAC,eAAgB,GAAIjD,EAAQ,KAAO,KAC3DlC,EAAkBoF,SAAS5C,KAAK,EAAK,EAAG,GAAI6C,eAAgB,IAC5DrF,EAAkBsF,UAAY,EAG9BzF,EAAa,IAAIqF,EAAAK,oBAAqBlG,GACtCQ,EAAW8C,SAAW,IAAIuC,EAAAM,4BAC1B3F,EAAW8C,SAAS8C,eAAiB,GACrC5F,EAAW8C,SAAS+C,UAAW,cAAeC,OAAQtF,EAAOO,6BAC7Df,EAAWuB,MAAMoB,IAAKnC,EAAOe,MAAOf,EAAOe,OAC3CvB,EAAW+F,OAAS5F,EAGpBF,EAAS,IAAI+F,EAAAC,eAAgB,IAAI3G,EAAA4G,kBAAyB,CACzDvC,IAAK3D,EAAW4D,OAAOC,QACvBsC,SAAU7G,EAAA8G,kBAIX3G,EAAW,IAAI4G,EAAAC,cAAenG,EAAmBX,EAAS4F,YAC1D3F,EAASmE,OAAO2C,EAAI,IACpB9G,EAAS4D,SACT5D,EAAS+G,iBAAkB,UAAU,KAEpCxG,EAAWmC,OAAO,IAInB/B,EAAQ,IAAId,EAAAmH,MACZ/G,EAAyB,IAAIJ,EAAAmH,MAE7BnG,EAAY2E,SAASyB,eAAgB,WAGrC,MAAMC,GAAgB,IAAIC,EAAAC,YACxBC,UAAW,kHACXC,MAAMlD,IAENA,EAAQmD,QAAU1H,EAAA2H,iCAClB7G,EAAM8G,YAAcrD,EACpBzD,EAAM+G,WAAatD,EAEZA,KAKHuD,EAAY,IAAIC,EAAAC,uBAChBC,GAAc,IAAIC,EAAAC,YACtBX,UAAW,mGACXC,MAAMW,IAEN,MAAMC,EAAQ,IAAIrI,EAAAsI,MAGlBF,EAAKG,MAAM7F,MAAM8F,UAAW,GAC5BJ,EAAKG,MAAMzE,oBACXsE,EAAKG,MAAME,UAAU9D,IAEpBA,EAAE+D,YAAa,EACf/D,EAAEgE,eAAgB,CAAI,IAGvBN,EAAMO,IAAKR,EAAKG,OAEhB,MAAMM,EAAM,IAAI7I,EAAA8I,KAChBD,EAAIE,cAAeX,EAAKG,OAGxB,MAAMvD,EAAQ,IAAIhF,EAAAgJ,KACjB,IAAIhJ,EAAAiJ,iBAAwB,EAAG,EAAG,GAAK,KACvC,IAAIjJ,EAAAkJ,qBAA4B,CAAE9H,MAAO,SAAUC,UAAW,GAAKC,UAAW,MAE/E0D,EAAMmE,SAAWnE,EAAMmE,SAASC,eAChCpE,EAAMmE,SAASE,cACfrE,EAAMiB,SAASgB,EAAI4B,EAAIS,IAAIrC,EAAI,IAC/BjC,EAAM2D,eAAgB,EACtBN,EAAMO,IAAK5D,GAEX,MAAMuE,EAAO,IAAIvJ,EAAAgJ,KAChB,IAAIhJ,EAAAwJ,YAAmB,GAAI,EAAG,IAC9B,IAAIxJ,EAAAkJ,qBAA4B,CAAE9H,MAAO,SAAUC,UAAW,EAAGC,UAAW,KAY7E,SAASmI,EAAuBC,GAE/B,MAAMC,EAAoB,IAAIC,EAAAC,kBAAmBhJ,EAAmBX,EAAS4F,YAC7E6D,EAAkBzC,iBAAkB,gBAAgB,KAEnDxG,EAAWmC,OAAO,IAInB8G,EAAkBzC,iBAAkB,oBAAsB4C,IAEzD3J,EAASqB,SAAYsI,EAAEC,KAAK,IAI7BJ,EAAkBK,OAAQN,GAC1BtJ,EAAuBwI,IAAKe,E,CA1B7BJ,EAAKb,YAAa,EAClBa,EAAKZ,eAAgB,EACrBY,EAAKJ,SAAWI,EAAKJ,SAASC,eAC9BG,EAAKJ,SAASE,cACdE,EAAKtD,SAASgE,EAAI,EAClBV,EAAKtD,SAASgB,EAAI4B,EAAIS,IAAIrC,EAAI,EAC9BsC,EAAKtD,SAASiE,EAAIrB,EAAIS,IAAIY,EAAI,GAC9B7B,EAAMO,IAAKW,GAwBXjJ,EAAS,GACTC,EAAa,GAEbF,EAAY,IAAI0F,EAAAoE,kBAAmB,UACnC9J,EAAU4F,SAAS5C,IAAK,EAAG,EAAK,GAChChD,EAAU+J,MAAQrF,KAAKsF,GAAK,IAC5BhK,EAAUiK,MAAQ,EAClBjK,EAAUkK,SAAW,EACrBlK,EAAUmK,SAAW,EACrBnK,EAAUoK,UAAY,GACtBpK,EAAUqK,OAAS,GAEnBrK,EAAUsK,OAAOC,QAAQC,MAAQ,IACjCxK,EAAUsK,OAAOC,QAAQE,OAAS,IAClCzK,EAAUsK,OAAOlE,OAAOsE,KAAO,GAC/B1K,EAAUsK,OAAOlE,OAAOuE,IAAM,GAC9B3K,EAAUsK,OAAOM,MAAQ,EACzB5K,EAAUqI,YAAa,EACvBL,EAAMO,IAAKvI,GAEXE,EAAW2K,KAAM7K,GACjBC,EAAO4K,KAAM7K,GAEb,MAAM8K,EAAe9K,EAAUiE,OAC/B6G,EAAalF,SAASgE,EAAI,EAC1BkB,EAAalF,SAASgB,EAAIjC,EAAMiB,SAASgB,EAAI,EAC7CkE,EAAalF,SAASiE,EAAI,IAC1BiB,EAAarH,oBACbzD,EAAUyD,oBACVuE,EAAMO,IAAKuC,GAEX3K,EAAkB,IAAIR,EAAA6E,gBAAuBxE,GAC7CD,EAAuBwI,IAAKpI,GAE5BiJ,EAAuBpJ,GACvBoJ,EAAuB0B,GAGvB,MAAMC,EAAcnK,EAAeoD,KAAKgH,IAEhC,IAAItF,EAAAuF,WAAY9D,UAAW6D,KAMnC,OAFAzK,EAAY,CAAEoE,EAAMxB,SAAU+F,EAAK/F,UAE5B+H,QAAQC,IAAK,CAAE1D,EAAU2D,SAAUpD,GAASkD,QAAQC,IAAKJ,IAAiB,IAGjF3D,MAAM,EAAIiE,EAAQC,MAElB5K,EAAc4K,EACdlL,EAAYiL,EAEZ5K,EAAM8H,IAAK8C,EAAOnD,OAElB,MA1PHqD,IA0PWA,EA1PXjI,SA0PgBA,EA1PhBF,UA0P0BA,EA1P1BI,OA0PqCA,GAAW6H,EACvCvC,EAAWyC,EAAIzC,SACf3F,EAAW9C,EAAW8C,SAE5BA,EAASoI,IAAIlI,WAAYkI,GACzBpI,EAASqI,gBAAgBnI,WACxByF,EAAS2C,WAAWC,OACpB5C,EAAS2C,WAAWE,QACpB7C,EAAS2C,WAAWG,GACpB9C,EAAS2C,WAAW1K,OAErBoC,EAAS0I,uBAAuBxI,WAAYyF,EAAS2C,WAAWK,eAChE3I,EAASG,SAASyI,YAAalM,EAAU,KAAM,KAAMyD,GACrDH,EAASC,UAAUC,WAAYD,EAAWE,GAC1CH,EAAS6I,YAAY3I,WAAYxD,EAAUa,GAC3CyC,EAASK,OAAOH,WAAYG,EAAQ9C,GACpCL,EAAW8C,SAAS8I,WAAW5I,WAAY5C,EAAM8G,aAEjDE,EAAUyE,SAAS,UAIfhB,QAAQC,IAAK,CAAEvD,EAAaZ,IAElC1B,SAASyB,eAAgB,WAAYoF,SAGrCnK,IACAP,OAAOoF,iBAAkB,SAAU7E,GACnC,MAAMoK,EAAM,IAAIC,EAAAC,IAChBF,EAAI7D,IAAK1H,EAAQ,WACjBuL,EAAI7D,IAAK1H,EAAQ,yBACjBuL,EAAI7D,IAAK1H,EAAQ,mBAEjB,MAAM0L,EAAWH,EAAII,UAAW,gBAChCD,EAAShE,IAAK1H,EAAQ,8BAA+B4L,UAAU/C,IAE9DrJ,EAAW8C,SAAS+C,UAAW,cAAeC,OAAQuD,IACtDrJ,EAAWmC,OAAO,IAGnB+J,EAAShE,IAAK1H,EAAQ,QAAS,EAAG,EAAG,GAAI4L,UAAU/C,IAElDrJ,EAAWuB,MAAMoB,IAAK0G,EAAOA,EAAO,IAGrC6C,EAAShE,IAAK1H,EAAQ,kBAAmB,EAAG,GAAI,GAChD0L,EAAShE,IAAK1H,EAAQ,qBAAsB,EAAG,GAAI4L,UAAU,KAE5DpM,EAAWmC,OAAO,IAGnB+J,EAAShE,IAAK1H,EAAQ,UAAW,EAAG,GAAI,GAAI4L,UAAU,KAErDpM,EAAWmC,OAAO,IAGnB+J,EAAShE,IAAK1H,EAAQ,kBAAmB,GAAK,GAAI4L,UAAU,KAE3DzK,GAAU,IAIOoK,EAAII,UAAW,eACvBjE,IAAK1H,EAAQ,uBAAwB,EAAG,IAAK4L,UAAU,KAEhEpM,EAAWmC,OAAO,IAInB,MAAMkK,EAAaN,EAAII,UAAW,kBAClCE,EAAWC,SAAU9L,EAAOC,cAAe,SAAU2L,SAAU7J,GAC/D8J,EAAWnE,IAAK1H,EAAOC,cAAe,YAAa,EAAG,GAAI2L,SAAU7J,GACpE8J,EAAWnE,IAAK1H,EAAOC,cAAe,YAAa,EAAG,GAAI2L,SAAU7J,GACpE8J,EAAWE,QAEX,MAAMC,EAAaT,EAAII,UAAW,iBAClCK,EAAWF,SAAU9L,EAAOK,aAAc,SAAUuL,SAAU7J,GAC9DiK,EAAWtE,IAAK1H,EAAOK,aAAc,YAAa,EAAG,GAAIuL,SAAU7J,GACnEiK,EAAWtE,IAAK1H,EAAOK,aAAc,YAAa,EAAG,GAAIuL,SAAU7J,GACnEiK,EAAWD,QAEX,MAAME,EAAcV,EAAII,UAAW,cACnCM,EAAYH,SAAU3M,EAAW,SAAUyM,SAAU7J,GACrDkK,EAAYvE,IAAKvI,EAAW,YAAa,EAAK,IAAO,KAAOyM,SAAU7J,GACtEkK,EAAYvE,IAAKvI,EAAW,SAAU,EAAK,IAAOyM,SAAU7J,GAC5DkK,EAAYvE,IAAKvI,EAAW,QAAS,EAAK,GAAMyM,SAAU7J,GAC1DkK,EAAYvE,IAAKvI,EAAW,WAAY,EAAK,IAAOyM,SAAU7J,GAC9DkK,EAAYvE,IAAKvI,EAAW,QAAS,EAAK0E,KAAKsF,GAAK,GAAMyC,SAAU7J,GACpEkK,EAAYvE,IAAKvI,EAAW,WAAY,EAAK,GAAMyM,SAAU7J,GAC7DkK,EAAYvE,IAAK1H,EAAQ,cAAc,EAAKD,EAAemM,OAAS,EAAG,GAAIN,UAAUO,IAEpFhN,EAAUiN,YAAmB,IAAND,EAAY,KAAOtM,EAAasM,GACvDpK,GAAO,IAIRC,G,CA1RDqK","sources":["example/spotLights.js"],"sourcesContent":["import * as THREE from 'three';\nimport { FullScreenQuad } from 'three/examples/jsm/postprocessing/Pass.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { PathTracingRenderer, PhysicalPathTracingMaterial, PhysicalCamera, PhysicalSpotLight, IESLoader } from '../src/index.js';\nimport { PathTracingSceneWorker } from '../src/workers/PathTracingSceneWorker.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls.js';\n\nlet renderer, controls, transformControlsScene, spotLight, lights, spotLights, spotLightHelper, sceneInfo, ptRenderer, fsQuad, materials;\nlet perspectiveCamera;\nlet scene;\nlet iesTextures;\nlet samplesEl;\n\n// ies library profiles\nconst iesProfileURLs = [\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/0646706b3d2d9658994fc4ad80681dec.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/06b4cfdc8805709e767b5e2e904be8ad.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/007cfb11e343e2f42e3b476be4ab684e.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/01dac7d6c646814dcda6780e7b7b4566.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/108b32f07d6d38a7a6528a6d307440df.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1aec5958092c236d005093ca27ebe378.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/02a7562c650498ebb301153dbbf59207.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1a936937a49c63374e6d4fbed9252b29.ies',\n\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/00c6ce79e1d2cdf3a1fb491aaaa47ae0.ies',\n];\n\n// gui parameters\nconst params = {\n\n\tfloorMaterial: {\n\t\tcolor: '#555555',\n\t\troughness: 0.05,\n\t\tmetalness: 0.4,\n\t},\n\twallMaterial: {\n\t\tcolor: '#a06464',\n\t\troughness: 0.4,\n\t\tmetalness: 0.1,\n\t},\n\n\tenabled: true,\n\tmultipleImportanceSampling: true,\n\tenvironmentIntensity: 0.1,\n\tbounces: 3,\n\tsamplesPerFrame: 1,\n\tresolutionScale: 1 / window.devicePixelRatio,\n\tfilterGlossyFactor: 0.5,\n\ttiles: 2,\n\tiesProfile: - 1,\n\tshowTransformControls: false,\n\tshowLightHelper: false,\n};\n\n// adjust performance parameters for mobile\nconst aspectRatio = window.innerWidth / window.innerHeight;\nif ( aspectRatio < 0.65 ) {\n\n\tparams.resolutionScale *= 0.5;\n\tparams.tiles = 2;\n\n}\n\ninit();\n\nasync function init() {\n\n\t// init renderer\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\n\trenderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\trenderer.setClearColor( 0, 0 );\n\trenderer.shadowMap.enabled = true;\n\trenderer.physicallyCorrectLights = true;\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// init camera\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tperspectiveCamera = new PhysicalCamera( 75, aspect, 0.025, 500 );\n\tperspectiveCamera.position.set( - 2, 4, 8 ).multiplyScalar( 0.8 );\n\tperspectiveCamera.bokehSize = 0;\n\n\t// init path traer\n\tptRenderer = new PathTracingRenderer( renderer );\n\tptRenderer.material = new PhysicalPathTracingMaterial();\n\tptRenderer.material.backgroundBlur = 0.1;\n\tptRenderer.material.setDefine( 'FEATURE_MIS', Number( params.multipleImportanceSampling ) );\n\tptRenderer.tiles.set( params.tiles, params.tiles );\n\tptRenderer.camera = perspectiveCamera;\n\n\t// init copy quad\n\tfsQuad = new FullScreenQuad( new THREE.MeshBasicMaterial( {\n\t\tmap: ptRenderer.target.texture,\n\t\tblending: THREE.CustomBlending,\n\t} ) );\n\n\t// init controls\n\tcontrols = new OrbitControls( perspectiveCamera, renderer.domElement );\n\tcontrols.target.y = 1.5;\n\tcontrols.update();\n\tcontrols.addEventListener( 'change', () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\n\tscene = new THREE.Scene();\n\ttransformControlsScene = new THREE.Scene();\n\n\tsamplesEl = document.getElementById( 'samples' );\n\n\t// load the env map\n\tconst envMapPromise = new RGBELoader()\n\t\t.loadAsync( 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr' )\n\t\t.then( texture => {\n\n\t\t\ttexture.mapping = THREE.EquirectangularReflectionMapping;\n\t\t\tscene.environment = texture;\n\t\t\tscene.background = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t// load the geometry\n\tconst generator = new PathTracingSceneWorker();\n\tconst gltfPromise = new GLTFLoader()\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/steampunk-robot/scene.gltf' )\n\t\t.then( gltf => {\n\n\t\t\tconst group = new THREE.Group();\n\n\t\t\t// objects\n\t\t\tgltf.scene.scale.setScalar( 1 );\n\t\t\tgltf.scene.updateMatrixWorld();\n\t\t\tgltf.scene.traverse( c => {\n\n\t\t\t\tc.castShadow = true;\n\t\t\t\tc.receiveShadow = true;\n\n\t\t\t} );\n\t\t\tgroup.add( gltf.scene );\n\n\t\t\tconst box = new THREE.Box3();\n\t\t\tbox.setFromObject( gltf.scene );\n\n\t\t\t// init environment\n\t\t\tconst floor = new THREE.Mesh(\n\t\t\t\tnew THREE.CylinderGeometry( 8, 8, 0.5, 200 ),\n\t\t\t\tnew THREE.MeshStandardMaterial( { color: 0xffffff, roughness: 0.5, metalness: 0.2 } ),\n\t\t\t);\n\t\t\tfloor.geometry = floor.geometry.toNonIndexed();\n\t\t\tfloor.geometry.clearGroups();\n\t\t\tfloor.position.y = box.min.y - 0.25;\n\t\t\tfloor.receiveShadow = true;\n\t\t\tgroup.add( floor );\n\n\t\t\tconst wall = new THREE.Mesh(\n\t\t\t\tnew THREE.BoxGeometry( 14, 6, 0.5 ),\n\t\t\t\tnew THREE.MeshStandardMaterial( { color: 0xffffff, roughness: 0, metalness: 1.0 } ),\n\t\t\t);\n\t\t\twall.castShadow = true;\n\t\t\twall.receiveShadow = true;\n\t\t\twall.geometry = wall.geometry.toNonIndexed();\n\t\t\twall.geometry.clearGroups();\n\t\t\twall.position.x = 0.0;\n\t\t\twall.position.y = box.min.y + 3;\n\t\t\twall.position.z = box.min.z - 0.5;\n\t\t\tgroup.add( wall );\n\n\t\t\t// transform controls\n\t\t\tfunction makeTransformControls( object ) {\n\n\t\t\t\tconst transformControls = new TransformControls( perspectiveCamera, renderer.domElement );\n\t\t\t\ttransformControls.addEventListener( 'objectChange', () => {\n\n\t\t\t\t\tptRenderer.reset();\n\n\t\t\t\t} );\n\n\t\t\t\ttransformControls.addEventListener( 'dragging-changed', ( e ) => {\n\n\t\t\t\t\tcontrols.enabled = ! e.value;\n\n\t\t\t\t} );\n\n\t\t\t\ttransformControls.attach( object );\n\t\t\t\ttransformControlsScene.add( transformControls );\n\n\t\t\t}\n\n\t\t\t// spot light\n\t\t\tlights = [];\n\t\t\tspotLights = [];\n\n\t\t\tspotLight = new PhysicalSpotLight( 0xffffff );\n\t\t\tspotLight.position.set( 0, 7.0, 4 );\n\t\t\tspotLight.angle = Math.PI / 4.5;\n\t\t\tspotLight.decay = 0;\n\t\t\tspotLight.penumbra = 1.0;\n\t\t\tspotLight.distance = 0.0;\n\t\t\tspotLight.intensity = 50.0;\n\t\t\tspotLight.radius = 0.5;\n\n\t\t\tspotLight.shadow.mapSize.width = 512;\n\t\t\tspotLight.shadow.mapSize.height = 512;\n\t\t\tspotLight.shadow.camera.near = 0.1;\n\t\t\tspotLight.shadow.camera.far = 10.0;\n\t\t\tspotLight.shadow.focus = 1.0;\n\t\t\tspotLight.castShadow = true;\n\t\t\tgroup.add( spotLight );\n\n\t\t\tspotLights.push( spotLight );\n\t\t\tlights.push( spotLight );\n\n\t\t\tconst targetObject = spotLight.target;\n\t\t\ttargetObject.position.x = 0;\n\t\t\ttargetObject.position.y = floor.position.y + 2;\n\t\t\ttargetObject.position.z = 0.05;\n\t\t\ttargetObject.updateMatrixWorld();\n\t\t\tspotLight.updateMatrixWorld();\n\t\t\tgroup.add( targetObject );\n\n\t\t\tspotLightHelper = new THREE.SpotLightHelper( spotLight );\n\t\t\ttransformControlsScene.add( spotLightHelper );\n\n\t\t\tmakeTransformControls( spotLight );\n\t\t\tmakeTransformControls( targetObject );\n\n\t\t\t// ies textures\n\t\t\tconst iesPromises = iesProfileURLs.map( url => {\n\n\t\t\t\treturn new IESLoader().loadAsync( url );\n\n\t\t\t} );\n\n\t\t\tmaterials = [ floor.material, wall.material ];\n\n\t\t\treturn Promise.all( [ generator.generate( group ), Promise.all( iesPromises ) ] );\n\n\t\t} )\n\t\t.then( ( [ result, _iesTextures ] ) => {\n\n\t\t\tiesTextures = _iesTextures;\n\t\t\tsceneInfo = result;\n\n\t\t\tscene.add( result.scene );\n\n\t\t\tconst { bvh, textures, materials, lights } = result;\n\t\t\tconst geometry = bvh.geometry;\n\t\t\tconst material = ptRenderer.material;\n\n\t\t\tmaterial.bvh.updateFrom( bvh );\n\t\t\tmaterial.attributesArray.updateFrom(\n\t\t\t\tgeometry.attributes.normal,\n\t\t\t\tgeometry.attributes.tangent,\n\t\t\t\tgeometry.attributes.uv,\n\t\t\t\tgeometry.attributes.color,\n\t\t\t);\n\t\t\tmaterial.materialIndexAttribute.updateFrom( geometry.attributes.materialIndex );\n\t\t\tmaterial.textures.setTextures( renderer, 2048, 2048, textures );\n\t\t\tmaterial.materials.updateFrom( materials, textures );\n\t\t\tmaterial.iesProfiles.updateFrom( renderer, iesTextures );\n\t\t\tmaterial.lights.updateFrom( lights, iesTextures );\n\t\t\tptRenderer.material.envMapInfo.updateFrom( scene.environment );\n\n\t\t\tgenerator.dispose();\n\n\t\t} );\n\n\tawait Promise.all( [ gltfPromise, envMapPromise ] );\n\n\tdocument.getElementById( 'loading' ).remove();\n\n\t// gui\n\tonResize();\n\twindow.addEventListener( 'resize', onResize );\n\tconst gui = new GUI();\n\tgui.add( params, 'enabled' );\n\tgui.add( params, 'showTransformControls' );\n\tgui.add( params, 'showLightHelper' );\n\n\tconst ptFolder = gui.addFolder( 'Path Tracing' );\n\tptFolder.add( params, 'multipleImportanceSampling' ).onChange( value => {\n\n\t\tptRenderer.material.setDefine( 'FEATURE_MIS', Number( value ) );\n\t\tptRenderer.reset();\n\n\t} );\n\tptFolder.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\n\n\t\tptRenderer.tiles.set( value, value );\n\n\t} );\n\tptFolder.add( params, 'samplesPerFrame', 1, 10, 1 );\n\tptFolder.add( params, 'filterGlossyFactor', 0, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tptFolder.add( params, 'bounces', 1, 30, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tptFolder.add( params, 'resolutionScale', 0.1, 1 ).onChange( () => {\n\n\t\tonResize();\n\n\t} );\n\n\tconst envFolder = gui.addFolder( 'Environment' );\n\tenvFolder.add( params, 'environmentIntensity', 0, 10 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\n\tconst matFolder1 = gui.addFolder( 'Floor Material' );\n\tmatFolder1.addColor( params.floorMaterial, 'color' ).onChange( reset );\n\tmatFolder1.add( params.floorMaterial, 'roughness', 0, 1 ).onChange( reset );\n\tmatFolder1.add( params.floorMaterial, 'metalness', 0, 1 ).onChange( reset );\n\tmatFolder1.close();\n\n\tconst matFolder2 = gui.addFolder( 'Wall Material' );\n\tmatFolder2.addColor( params.wallMaterial, 'color' ).onChange( reset );\n\tmatFolder2.add( params.wallMaterial, 'roughness', 0, 1 ).onChange( reset );\n\tmatFolder2.add( params.wallMaterial, 'metalness', 0, 1 ).onChange( reset );\n\tmatFolder2.close();\n\n\tconst lightFolder = gui.addFolder( 'Spot Light' );\n\tlightFolder.addColor( spotLight, 'color' ).onChange( reset );\n\tlightFolder.add( spotLight, 'intensity', 0.0, 200.0, 0.01 ).onChange( reset );\n\tlightFolder.add( spotLight, 'radius', 0.0, 10.0 ).onChange( reset );\n\tlightFolder.add( spotLight, 'decay', 0.0, 2.0 ).onChange( reset );\n\tlightFolder.add( spotLight, 'distance', 0.0, 20.0 ).onChange( reset );\n\tlightFolder.add( spotLight, 'angle', 0.0, Math.PI / 2.0 ).onChange( reset );\n\tlightFolder.add( spotLight, 'penumbra', 0.0, 1.0 ).onChange( reset );\n\tlightFolder.add( params, 'iesProfile', - 1, iesProfileURLs.length - 1, 1 ).onChange( v => {\n\n\t\tspotLight.iesTexture = v === - 1 ? null : iesTextures[ v ];\n\t\treset();\n\n\t} );\n\n\tanimate();\n\n}\n\nfunction onResize() {\n\n\tconst w = window.innerWidth;\n\tconst h = window.innerHeight;\n\tconst scale = params.resolutionScale;\n\tconst dpr = window.devicePixelRatio;\n\n\tptRenderer.setSize( w * scale * dpr, h * scale * dpr );\n\tptRenderer.reset();\n\n\trenderer.setSize( w, h );\n\trenderer.setPixelRatio( window.devicePixelRatio * scale );\n\n\tconst aspect = w / h;\n\n\tperspectiveCamera.aspect = aspect;\n\tperspectiveCamera.updateProjectionMatrix();\n\n}\n\nfunction reset() {\n\n\tptRenderer.reset();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\t// update materials\n\tconst m0 = materials[ 0 ];\n\tm0.color.set( params.floorMaterial.color ).convertSRGBToLinear();\n\tm0.metalness = params.floorMaterial.metalness;\n\tm0.roughness = params.floorMaterial.roughness;\n\n\tconst m1 = materials[ 1 ];\n\tm1.color.set( params.wallMaterial.color ).convertSRGBToLinear();\n\tm1.metalness = params.wallMaterial.metalness;\n\tm1.roughness = params.wallMaterial.roughness;\n\n\t// update path tracer\n\tptRenderer.material.materials.updateFrom( sceneInfo.materials, sceneInfo.textures );\n\n\tptRenderer.material.filterGlossyFactor = params.filterGlossyFactor;\n\tptRenderer.material.environmentIntensity = params.environmentIntensity;\n\tptRenderer.material.bounces = params.bounces;\n\tptRenderer.material.physicalCamera.updateFrom( perspectiveCamera );\n\n\tptRenderer.material.lights.updateFrom( lights, iesTextures );\n\n\t// update objects\n\tperspectiveCamera.updateMatrixWorld();\n\tspotLightHelper.update();\n\n\n\tif ( ! params.enabled || ptRenderer.samples < 1 ) {\n\n\t\trenderer.render( scene, perspectiveCamera );\n\n\t}\n\n\tif ( params.enabled ) {\n\n\t\t// render\n\t\tfor ( let i = 0, l = params.samplesPerFrame; i < l; i ++ ) {\n\n\t\t\tptRenderer.update();\n\n\t\t}\n\n\n\t\trenderer.autoClear = false;\n\n\t\tfsQuad.material.map = ptRenderer.target.texture;\n\t\tfsQuad.material.depthWrite = false;\n\t\tfsQuad.render( renderer );\n\n\t\ttransformControlsScene.children.forEach( c => {\n\n\t\t\tc.visible = c instanceof THREE.SpotLightHelper ? params.showLightHelper : params.showTransformControls;\n\t\t\tif ( 'enabled' in c ) c.enabled = params.showTransformControls;\n\n\t\t} );\n\n\t\trenderer.render( transformControlsScene, perspectiveCamera );\n\n\t\trenderer.autoClear = true;\n\n\t\tsamplesEl.innerText = `Samples: ${ Math.floor( ptRenderer.samples ) }`;\n\n\t}\n\n}\n"],"names":["$ilwiq","parcelRequire","$4f28f0606e3919d1$var$renderer","$4f28f0606e3919d1$var$controls","$4f28f0606e3919d1$var$transformControlsScene","$4f28f0606e3919d1$var$spotLight","$4f28f0606e3919d1$var$lights","$4f28f0606e3919d1$var$spotLights","$4f28f0606e3919d1$var$spotLightHelper","$4f28f0606e3919d1$var$sceneInfo","$4f28f0606e3919d1$var$ptRenderer","$4f28f0606e3919d1$var$fsQuad","$4f28f0606e3919d1$var$materials","$4f28f0606e3919d1$var$perspectiveCamera","$4f28f0606e3919d1$var$scene","$4f28f0606e3919d1$var$iesTextures","$4f28f0606e3919d1$var$samplesEl","$4f28f0606e3919d1$var$iesProfileURLs","$4f28f0606e3919d1$var$params","floorMaterial","color","roughness","metalness","wallMaterial","enabled","multipleImportanceSampling","environmentIntensity","bounces","samplesPerFrame","resolutionScale","window","devicePixelRatio","filterGlossyFactor","tiles","iesProfile","showTransformControls","showLightHelper","$4f28f0606e3919d1$var$onResize","w","innerWidth","h","innerHeight","scale","dpr","setSize","reset","setPixelRatio","aspect","updateProjectionMatrix","$4f28f0606e3919d1$var$reset","$4f28f0606e3919d1$var$animate","requestAnimationFrame","m0","set","convertSRGBToLinear","m1","material","materials","updateFrom","textures","physicalCamera","lights","updateMatrixWorld","update","samples","render","i","l","autoClear","map","target","texture","depthWrite","children","forEach","c","visible","SpotLightHelper","innerText","Math","floor","async","WebGLRenderer","antialias","toneMapping","ACESFilmicToneMapping","shadowMap","type","PCFSoftShadowMap","setClearColor","physicallyCorrectLights","document","body","appendChild","domElement","$4CEV9","PhysicalCamera","position","multiplyScalar","bokehSize","PathTracingRenderer","PhysicalPathTracingMaterial","backgroundBlur","setDefine","Number","camera","$RPVlj","FullScreenQuad","MeshBasicMaterial","blending","CustomBlending","$5Rd1x","OrbitControls","y","addEventListener","Scene","getElementById","envMapPromise","$891vQ","RGBELoader","loadAsync","then","mapping","EquirectangularReflectionMapping","environment","background","generator","$cVdfP","PathTracingSceneWorker","gltfPromise","$7lx9d","GLTFLoader","gltf","group","Group","scene","setScalar","traverse","castShadow","receiveShadow","add","box","Box3","setFromObject","Mesh","CylinderGeometry","MeshStandardMaterial","geometry","toNonIndexed","clearGroups","min","wall","BoxGeometry","makeTransformControls","object","transformControls","$fUhpq","TransformControls","e","value","attach","x","z","PhysicalSpotLight","angle","PI","decay","penumbra","distance","intensity","radius","shadow","mapSize","width","height","near","far","focus","push","targetObject","iesPromises","url","IESLoader","Promise","all","generate","result","_iesTextures","bvh","attributesArray","attributes","normal","tangent","uv","materialIndexAttribute","materialIndex","setTextures","iesProfiles","envMapInfo","dispose","remove","gui","$jiuw3","GUI","ptFolder","addFolder","onChange","matFolder1","addColor","close","matFolder2","lightFolder","length","v","iesTexture","$4f28f0606e3919d1$var$init"],"version":3,"file":"spotLights.9590d5be.js.map"}